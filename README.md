# Quant/Qual Trading Bot

## Overview
The Quant/Qual Trading Bot is an advanced algorithmic trading application that combines quantitative and qualitative analysis to make informed buy/sell/hold decisions on stocks. The app integrates machine learning models for quantitative predictions with sentiment analysis of financial news for qualitative insights. The app offers a user-friendly graphical interface and supports paper trading via the Alpaca API.

## Installation and Setup
### Prerequisites
1. Hardware Requirements
    - GPU: An NVIDIA GPU is recommended for faster training of models (especially the quantitative model).
    - RAM: Minimum of 8GB, though 16GB is preferred.
2. Software Requirements
    - Operating System: Linux (Ubuntu distro) or Windows 10/11
    - Required Python packages are bundled with the app.
3. API Access
    - Create an account with [Alpaca Markets](https://alpaca.markets/) for trading api access
### Installation
- The app is distributed as an executable
    - Download the `.exe` or `.app` file from the release section.

## Getting Started
### Step 1: Load Tickers
- The tickers.txt file contains stock symbols the bot monitors. Customize this file by adding or removing symbols.
### Step 2: API Credentials
- Add your Alpaca API key and secret to the alpaca_credentials.json file. Encrypt it using the provided utility to ensure security.
### Step 3: Train Models
- Use the Manual Training tab in the GUI to train the quantitative and qualitative models.
- Alternatively, enable the scheduler to automate training.
### Step 4: Make Decisions
- Review the View Decisions tab to check the Buy/Sell/Hold recommendations generated by the bot.
### Step 5: Execute Trades
- Use the Execute Trades tab to automatically place orders based on the bot's decisions.
### Step 6: Analyze Performance
- Monitor portfolio performance through the Performance Graph tab.

### Limitations
1. Hardware-Dependent Training:
    - Training the qualitative model is slow without an NVIDIA GPU.
    - CPU-only systems may experience significant delays.
2. API Limitations:
    - Requires valid Alpaca API credentials for live/paper trading.
    - API rate limits may impact data fetching and trade execution speed.
3. News Data Quality:
    - Sentiment analysis depends on the quality and availability of news articles.
4. Model Accuracy:
    - Predictions are based on historical data and do not account for unforeseen market changes.

## Machine Learning Models
1. ### Quantitative Model (Quant Model)
    1. **Feature Engineering**
        
        The model starts by processing historical stock data to generate predictive features. These features include:

        - Lagged Returns:
            - `Return_Lag1`, `Return_Lag2`, etc.: Percentage change in stock prices over the past 1 to 4 days.
        - Momentum and Trend Indicators:
            - **RSI (Relative Strength Index)**: Measures overbought/oversold conditions on a scale of 0 to 1.
            - **MACD (Moving Average Convergence Divergence)** and **MACD Signal Line**: Identify trend direction and strength.
            - **Rate of Change (ROC)**: Percentage change over 5-day intervals.
        - Volatility Indicators:
            - 5-day and 10-day rolling standard deviations of daily returns.
        - Volume-Based Indicator:
            - **OBV (On-Balance Volume)**: Reflects buying/selling pressure based on volume changes
        
        Data is preprocessed to handle missing values, normalize features, and remove outliers.
    2. **Model Training**

        The model is built using a combination of machine learning algorithms to capture various patterns:

        - Primary Models:
            - **XGBoost**: A powerful gradient-boosting algorithm optimized for structured/tabular data. It captures non-linear interactions between features.
            - **Random Forest**: An ensemble of decision trees, which improves robustness by averaging multiple tree predictions.
        - Meta Model:
            - **Stacking Regressor**: Combines predictions from XGBoost and Random Forest using a Linear Regression meta-model. The stacking model weighs the strengths of each base model to improve overall accuracy.
    3. **Hyperparameter Optimization**

        - **RandomizedSearchCV** is used for hyperparameter tuning. It selects the best configurations for XGBoost and Random Forest by exploring a defined parameter space (e.g., `n_estimators`, `max_depth`, etc.).
    4. **Model Evaluation**

        - Data is split into training (80%) and testing (20%) sets.
        - The model is evaluated using:
            - **Root Mean Squared Error (RMSE)**: Measures the prediction error.
            - Accuracy Within Thresholds:
                - Predictions are assessed for how often they fall within certain percentage deviations of the true returns (e.g., ±1% or ±5%).
    5. **Prediction**
        - Once trained, the model predicts the next-day return for a stock based on the most recent values of its technical indicators and derived features.
    6. **Output**
        - The predicted next-day return (as a percentage) is stored and passed to the Model Manager for integration with qualitative insights.
2. ### Qualitative Model (Qual Model)
    1. **Data Collection**
        - The qualitative model starts by gathering financial news articles for a predefined list of stock tickers (stored in `tickers.txt`) You can customize this if you want to train the model on other stocks.
    2. **Text Preprocessing**

        To ensure clean and relevant data, raw text undergoes several preprocessing steps:

        - **Data Cleaning**:
            - Removes non-alphanumeric characters, filler text, and irrelevant content such as disclaimers or promotional material.
            - Normalizes text to a consistent format using Unicode normalization.
        - **Article Text Extraction**:
            - The model extracts the main content of the news articles from their URLs using `BeautifulSoup`.
        - **Summariztion**
            - Large articles are summarized to their key points using a Transformer-based Summarization Pipeline powered by Hugging Face.
    3. **Sentiment Analysis**
        - Once the articles are summarized, the model evaluates the tone and sentiment of the content using a pre-trained sentiment analysis model:
            - Transformer Model: `distilbert-base-uncased-finetuned-sst-2-english`, a variant of BERT optimized for sentiment classification.
        - **Sentiment Classes**
            - Positive: Indicates favorable news sentiment for the stock.
            - Negative: Indicates unfavorable sentiment.
            - Neutral or Unknown: Indicates an absence of strong sentiment.
        - Each article is assigned a sentiment score based on the classification result.
    4. **Parallel Processing**
      - Since processing news articles is computationally intensive, tasks are distributed across threads:
        - Concurrent Execution: Using Python's `ThreadPoolExecutor`, multiple tickers are processed simultaneously to fetch news and evaluate sentiment scores.
    5. **Aggregate Sentiment Scoring**
        - After analyzing individual articles for a given ticker, the model computes an aggregate sentiment score:
        - **Weighted Scoring**:
            - Positive articles contribute +1 to the score.
            - Negative articles reduce the score by -1.
            - Neutral or unknown articles have minimal impact.
        - The final sentiment score reflects the overall market perception of the stock based on its recent news.
    6. **Integration**
        - The final sentiment scores are stored in a CSV file (`sentiment_scores.csv`) for integration with the Quantitative Model in the Model Manager.
        - Sentiment scores are later used to adjust the decision score for each stock, influencing the Buy/Sell/Hold recommendations.

## Model Manager
- **Integration of Models**:
    - Combines quantitative predictions (next-day return) with qualitative sentiment scores to compute a decision score for each stock.
    - Decision score formula:

        **Decision Score=(Quant Weight×Next-Day Return)+(Qual Weight×Sentiment Score)**
        - Default weights: Quantitative = 0.85, Qualitative = 0.15.
    - Decision Rules:
        - Buy: Decision score > 1.
        - Sell: Sell: Decision score < 0.
        - Hold: Hold: Decision score between 0 and 1.
    - Output
        - Decisions are saved to a CSV file (`buy_sell_decisions.csv`), including the ticker, predicted return, sentiment score, decision score, and action.
    - Efficiency
        - Loads models and sentiment data incrementally to manage memory and improve scalability for large ticker lists.

## Features
1. ### Scheduler
    - Automation:
        - Uses the APScheduler library to schedule and automate tasks.
    - Configurable Tasks:
        - Qualitative Model Updates: Fetches new sentiment scores daily during weekdays.
        - Quantitative Model Training: Runs weekly on Saturdays to retrain models with updated stock data.
        - Trade Execution: Executes trades based on decisions every weekday morning before market open.
    - Logging
        - Outputs detailed logs of scheduled task executions to a scheduler.log file for easy monitoring.
    - Background Operation
        - Runs silently in the background
2. ### Trade Execution
    - Alpaca API Integration:
        - Trades are executed using the Alpaca paper trading API, enabling safe testing of strategies without real monetary risk.
    - Action Handling
        - Buy: Submits a market order to purchase the recommended stock.
        - Sell: Validates the number of shares held before placing a sell order.
        - Hold: Skips execution for the ticker.
    - Credential Security
        - Credentials (API key and secret) are encrypted using a secure key (Fernet encryption) and stored in the application directory.
    - Error Handling:
        - Skips trades for stocks with missing data or insufficient shares and logs errors for debugging.
3. ### GUI
    - Built with PyQt5:
        - A modern and intuitive interface designed for ease of use and accessibility.
    - Tabs and Features:
        1. Welcome Tab: Overview of the app and links to resources like the GitHub Wiki.
        2. Manual Training Tab: Allows users to manually train quantitative and qualitative models.
        3. Scheduled Training Tab: Enables configuration of automated training tasks.
        4. Buy/Sell Decisions Tab: Displays the latest predictions and decisions from the models.
        5. Trade Execution Tab: Facilitates the execution of buy/sell orders with a single click.
        6. Performance Tab: Visualizes portfolio performance over time, including returns and comparisons to benchmarks (e.g., S&P 500).
        7. Settings Tab: Manages API credentials and application configurations.
    - Buttons, progress bars, log windows, and charts make it easy for users to monitor and control processes.
    - Alerts and warnings guide users in resolving issues, such as missing credentials or training errors.

## Contact & Support
- Email `nicholasfacciola@gmail.com` with issues or feature requests.
- Checkout the [Wiki](https://github.com/mustangThunderBird/algo-trading-bot/wiki) Page for more help